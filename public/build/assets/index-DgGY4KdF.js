import{u as q,j as e,bx as z,h as H,r as l,bs as L,H as M,a6 as O,ba as Y,a7 as G,t as U,m as J,v as K}from"./vendor-ksci8XOx.js";import{I as Q,B as W}from"./icon-naHlgVI0.js";import{A as X}from"./app-layout-Pi7D40XM.js";import{h as Z}from"./moment-BLMuvzoS.js";import{T as $,a as ee,b as p,c,d as se,e as o,f as ae}from"./table-CsJUq_dv.js";import{a as te,b as re,c as ne,d as ie,e as le,f as oe,g as ce,h as de,i as me,I as pe,A as ue}from"./app-pagination-DPGatvT0.js";import{B as u}from"./button-DHWtkJpJ.js";import xe from"./app-sale-details-modal-D1mHUi6v.js";import{B as he}from"./badge-C4OSgUs5.js";import je from"./receipt-CrwL1b9k.js";import{S as fe}from"./SaleReceiptPDF-BsFj6u8p.js";import"./utils-DYvR5uu3.js";import"./app-sidebar-header-CuX634ix.js";import"./mask-Dzd4Hpc-.js";import"./index-UBM-f53a.js";import"./app-D8H4l2Qz.js";import"./input-fAbRQJ3l.js";import"./dialog-g7TMowto.js";function be({saleId:r,disabled:t}){const{post:x,processing:h}=q(),j=()=>{x(route("app.sales.cancel",r),{preserveScroll:!0})};return e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsx(u,{variant:"destructive",size:"icon",title:"Cancelar Venda",disabled:!t,children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Cancelar venda?"}),e.jsx(oe,{children:"Esta ação irá cancelar a venda e devolver os itens ao estoque. Essa operação não poderá ser desfeita."})]}),e.jsxs(ce,{children:[e.jsx(de,{children:"Voltar"}),e.jsx(me,{onClick:j,disabled:h,className:"bg-red-600 hover:bg-red-700",children:"Confirmar Cancelamento"})]})]})]})}const ge=[{title:"Dashboard",href:route("app.dashboard")},{title:"Vendas",href:"#"}];function qe({sales:r}){var y,C,S,w,A;const{auth:t}=H().props,x=(y=t==null?void 0:t.user)==null?void 0:y.tenant,h=((C=t==null?void 0:t.user)==null?void 0:C.roles)===9||((S=t==null?void 0:t.user)==null?void 0:S.roles)===1,[j,f]=l.useState(!1),[R,P]=l.useState(null),[a,b]=l.useState(null),g=l.useRef(null),[D,N]=l.useState(!1),[B,v]=l.useState(!1),_=L.useReactToPrint({contentRef:g,onAfterPrint:()=>b(null)});l.useEffect(()=>{a&&_()},[a]);const I=s=>{P(s),f(!0)},T=s=>{v(!0);const i={...s,items:s.items.map(n=>{var d;return{name:((d=n.part)==null?void 0:d.name)||n.name||"Produto",selected_quantity:n.quantity,sale_price:n.unit_price}})};b(i),v(!1)},E=async s=>{var i;if(s){N(!0);try{const n=((i=s.customer)==null?void 0:i.name)||"Consumidor Final",d=s.items.map(m=>{var F;return{name:((F=m.part)==null?void 0:F.name)||m.name||"Produto",selected_quantity:m.quantity,sale_price:m.unit_price}}),k=await K(e.jsx(fe,{items:d,total:s.total_amount,customerName:n,sale:s,company:x})).toBlob(),V=URL.createObjectURL(k);window.open(V,"_blank")}catch(n){console.error("Erro ao gerar PDF:",n),alert("Erro ao gerar o PDF.")}finally{N(!1)}}};return e.jsxs(X,{children:[e.jsx(xe,{isOpen:j,onClose:()=>f(!1),sale:R}),e.jsx("div",{style:{display:"none"},children:e.jsx(je,{ref:g,paper:"80mm",items:(a==null?void 0:a.items)||[],total:new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format((a==null?void 0:a.total_amount)||0),customer:((w=a==null?void 0:a.customer)==null?void 0:w.name)||"Consumidor",sale:a})}),e.jsx(M,{title:"Vendas"}),e.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{iconNode:O,className:"w-8 h-8"}),e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Vendas"})]}),e.jsx("div",{children:e.jsx(W,{breadcrumbs:ge})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(pe,{placeholder:"Buscar vendas por número e cliente",url:"app.sales.index"})}),e.jsx("div",{className:"w-full flex justify-end"})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"border rounded-lg",children:e.jsxs($,{children:[e.jsx(ee,{children:e.jsxs(p,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Cliente"}),e.jsx(c,{children:"Total"}),e.jsx(c,{children:"Data venda"}),e.jsx(c,{})]})}),e.jsx(se,{children:(r==null?void 0:r.data.length)>0?(A=r==null?void 0:r.data)==null?void 0:A.map(s=>{var i;return e.jsxs(p,{children:[e.jsx(o,{children:s.sales_number}),e.jsx(o,{children:((i=s.customer)==null?void 0:i.name)||"Cliente não informado"}),e.jsx(o,{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_amount)}),e.jsx(o,{children:Z(s.created_at).format("DD/MM/YYYY")}),e.jsxs(o,{className:"flex justify-end gap-2",children:[s.status==="completed"&&e.jsx(be,{saleId:s.id,disabled:h}),s.status==="cancelled"&&e.jsx(he,{variant:"destructive",children:"Cancelada"}),e.jsxs(u,{type:"button",onClick:()=>E(s),disabled:B||D,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[D?e.jsx(Y,{className:"size-4 animate-spin"}):e.jsx(G,{className:"size-4"}),"Recibo PDF"]}),e.jsx(u,{onClick:()=>T(s),size:"icon",className:"bg-blue-600 hover:bg-blue-500 text-white",title:"Imprimir Recibo",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(u,{onClick:()=>I(s),size:"icon",className:"bg-orange-500 hover:bg-orange-600 text-white",title:"Ver Detalhes",children:e.jsx(J,{className:"h-4 w-4"})})]})]},s.id)}):e.jsx(p,{children:e.jsx(o,{colSpan:5,className:"h-16 w-full flex items-center justify-center",children:"Não há dados a serem mostrados no momento."})})}),e.jsx(ae,{children:e.jsx(p,{children:e.jsx(o,{colSpan:5,children:e.jsx(ue,{data:r})})})})]})})})]})}export{qe as default};
