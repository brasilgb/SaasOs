import{r as u,u as C,j as e,H as O,a0 as R,L as B,A as D,b as U}from"./vendor-9cxgAHzg.js";import{A as _}from"./app-layout-CNPaJFrw.js";import{B as k}from"./breadcrumbs-Bxu_pr7n.js";import{I as F}from"./app-sidebar-header-V2nHF7TD.js";import{B as g}from"./button-DFigV1aq.js";import{H}from"./heading-small-C_otBlWl.js";import{a as m,t as W}from"./app-toast-messages-BBGi5OF3.js";import"./mask-Dzd4Hpc-.js";import"./moment-BLMuvzoS.js";import"./utils-veIRhKZd.js";import"./index-C6x6Dy02.js";import"./app-87dSWR_K.js";import"./use-mobile-navigation-CPrEe7uA.js";import"./badge-Y4wF56ht.js";const f=4,te=({savedimages:i,orderid:p,errors:n})=>{const[j,v]=u.useState(0),{data:l,post:b,delete:N,processing:w,setData:h,reset:y}=C({images:[],order_id:p}),[o,c]=u.useState([]),S=t=>{const s=Array.from(t.target.files??[]);if(!s.length)return;if(s.some(a=>!a.type.startsWith("image/"))){m("Erro","Apenas imagens são permitidas."),t.target.value="";return}const r=i.length,d=l.images.length;if(r+d+s.length>f){m("Erro",`Esta ordem pode ter no máximo ${f} imagens no total.`),t.target.value="";return}const L=s.map(a=>{const x=URL.createObjectURL(a);return{file:a,preview:x,id:x}});c(a=>[...a,...L]),h("images",[...l.images,...s])},E=t=>{c(s=>s.filter(r=>r.id!==t)),h("images",l.images.filter((s,r)=>{var d;return((d=o[r])==null?void 0:d.id)!==t}))},I=t=>{if(t.preventDefault(),l.images.length===0){m("Erro","Selecione ao menos uma imagem.");return}b(route("app.images.store"),{forceFormData:!0,onSuccess:()=>{W("Sucesso","Imagens enviadas com sucesso."),y(),c([]),v(s=>s+1)},onError:s=>{Object.values(s).forEach(r=>{m("Erro",String(r))})}})},A=t=>{N(route("app.images.destroy",t))};return u.useEffect(()=>()=>{o.forEach(t=>URL.revokeObjectURL(t.preview))},[o]),e.jsxs(_,{children:[e.jsx(O,{title:"Imagens da Ordem"}),e.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{iconNode:R,className:"w-8 h-8"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Ordens"})]}),e.jsx(k,{breadcrumbs:[{title:"Dashboard",href:route("app.dashboard")},{title:"Ordens",href:route("app.orders.index")},{title:"Imagens",href:"#"}]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{children:e.jsx(g,{variant:"default",asChild:!0,children:e.jsxs(B,{href:route("app.orders.index"),children:[e.jsx(D,{"h-4":!0,"w-4":!0}),e.jsx("span",{children:"Voltar"})]})})}),e.jsx("div",{})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx(H,{title:"Imagens da Ordem de Serviço",description:"Envie até 4 imagens."}),e.jsxs("form",{onSubmit:I,className:"mt-4",children:[e.jsx("input",{type:"file",name:"images[]",multiple:!0,accept:"image/*",onChange:S,className:"w-full border rounded p-2"},j),(n==null?void 0:n.images)&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.images}),o.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:o.map(t=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.preview,className:"w-full h-32 object-cover rounded"}),e.jsx("button",{type:"button",onClick:()=>E(t.id),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs",children:"×"})]},t.id))}),(i==null?void 0:i.length)>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:i.map(t=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`/storage/orders/${p}/${t.filename}`,className:"w-full h-32 object-cover rounded"}),e.jsx("button",{type:"button",onClick:()=>A(t.id),className:"absolute top-1 right-1 bg-red-600 text-white rounded-full w-5 h-5 text-xs",children:"×"})]},t.id))}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs(g,{type:"submit",disabled:w,children:[e.jsx(U,{className:"mr-2"}),"Salvar"]})})]})]})})]})};export{te as default};
