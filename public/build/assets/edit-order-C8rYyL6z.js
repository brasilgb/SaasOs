import{f as U,r as y,u as Z,j as s,H as ee,a0 as se,L as ae,A as te,S as _,X as ie,b as le}from"./vendor-9cxgAHzg.js";import{B as ne}from"./breadcrumbs-Bxu_pr7n.js";import{I as re}from"./app-sidebar-header-BYkhpJ-r.js";import{B as N}from"./button-DFigV1aq.js";import{A as ce}from"./app-layout-RYJKCxBU.js";import{I as u}from"./input-D2aH1Wd-.js";import{L as r}from"./label-BRTi3l1J.js";import{T as v}from"./textarea-a2nrSQrB.js";import{b as q}from"./dataSelect-YUEq-QLc.js";import{I as oe}from"./input-error-DjQthEM2.js";import{d as S,c as p}from"./mask-Dzd4Hpc-.js";import{h as de}from"./moment-BLMuvzoS.js";import ue from"./add-parts-CKLViRWI.js";import{C as me,c as pe,f as ve}from"./card-C98LDifl.js";import{B as xe}from"./badge-Y4wF56ht.js";import{t as he}from"./app-toast-messages-BBGi5OF3.js";import{D as ge}from"./date-picker-B7Kdmu-S.js";import"./utils-veIRhKZd.js";import"./index-C6x6Dy02.js";import"./app-8wJPGVls.js";import"./dialog-CDKjSUwF.js";const fe=[{title:"Dashboard",href:route("app.dashboard")},{title:"Ordens",href:route("app.orders.index")},{title:"Editar",href:"#"}];function Ye({customers:P,order:a,technicals:D,equipments:E,parts:M,orderparts:j}){var w;const{ziggy:k,othersetting:n}=U().props,L=n!=null&&n.enableparts?"":"parts",{page:V,oc:z}=k.query,[b,x]=y.useState([]),h=P.map(e=>({value:e.id,label:e.name})),g=D.map(e=>({value:e.id,label:e.name})),f=E.map(e=>({value:e.id,label:e.equipment})),{data:l,post:B,setData:i,patch:I,progress:_e,processing:A,reset:je,errors:o}=Z({customer_id:a==null?void 0:a.customer_id,equipment_id:a==null?void 0:a.equipment_id,model:a==null?void 0:a.model,password:a==null?void 0:a.password,defect:a==null?void 0:a.defect,state_conservation:a==null?void 0:a.state_conservation,accessories:a==null?void 0:a.accessories,budget_description:a==null?void 0:a.budget_description,budget_value:a==null?void 0:a.budget_value,services_performed:a.services_performed,parts:a.parts,parts_value:a.parts_value,service_value:a.service_value,service_cost:a.service_cost,delivery_date:a.delivery_date,responsible_technician:a.responsible_technician,service_status:a==null?void 0:a.service_status,delivery_forecast:a==null?void 0:a.delivery_forecast,observations:a==null?void 0:a.observations,allparts:""}),O=e=>{x(t=>{const c=new Map(t.map(m=>[m.id,m]));return e.forEach(m=>{c.set(m.id,m)}),Array.from(c.values())})},T=async e=>{e.preventDefault(),I(route("app.orders.update",a.id),{onSuccess:()=>{he("Sucesso","Edição realizada com sucesso"),x([])}})};y.useEffect(()=>{if(n!=null&&n.enableparts){const e=new Map;(j||[]).forEach(d=>e.set(d.id,{id:d.id,sale_price:d.sale_price,quantity:d.pivot.quantity})),(b||[]).forEach(d=>e.set(d.id,{id:d.id,sale_price:d.sale_price,quantity:d.quantity}));const t=Array.from(e.values()),c=t.map(d=>({part_id:d.id,quantity:d.quantity})),m=t.reduce((d,F)=>d+Number(F.sale_price)*F.quantity,0);i(d=>({...d,allparts:c,parts_value:String(m)}))}},[b,j,n]),y.useEffect(()=>{i(t=>({...t,budget_value:S(t==null?void 0:t.budget_value)})),i(t=>({...t,parts_value:S(t==null?void 0:t.parts_value)})),i(t=>({...t,service_value:S(t==null?void 0:t.service_value)}));const e=parseFloat(l==null?void 0:l.parts_value)+parseFloat(l==null?void 0:l.service_value);i(t=>({...t,service_cost:e.toFixed(2)})),l.service_status==8&&i(t=>({...t,delivery_date:de().format("YYYY-MM-DD HH:mm:ss")}))},[l.parts_value,l.service_value,l.budget_value,l.delivery_date,l.service_status]);const Y=e=>{i("customer_id",(e==null?void 0:e.value)||"")},$=e=>{i("equipment_id",e==null?void 0:e.value)},H=e=>{i("service_status",e==null?void 0:e.value)},R=e=>{i("responsible_technician",e==null?void 0:e.value)},W=h==null?void 0:h.filter(e=>e.value==(a==null?void 0:a.customer_id)).map(e=>({value:e.value,label:e.label})),X=f==null?void 0:f.filter(e=>e.value==(a==null?void 0:a.equipment_id)).map(e=>({value:e.value,label:e.label})),G=(w=q)==null?void 0:w.filter(e=>e.value==(a==null?void 0:a.service_status)).map(e=>({value:e.value,label:e.label})),J=g==null?void 0:g.filter(e=>e.value==(a==null?void 0:a.responsible_technician)).map(e=>({value:e.value,label:e.label})),K=(e,t)=>{e.preventDefault(),B(route("app.orders.removePart",{order_id:a.id,part_id:t})),i(c=>({...c,parts_value:"0.00"})),i(c=>({...c,service_value:"0.00"})),i(c=>({...c,service_cost:"0.00"})),i(c=>({...c,allparts:[]})),x([])},Q=e=>{x(t=>t.filter(c=>c.id!==e))},C=[...(j||[]).map(e=>({...e,quantity:e.pivot.quantity,source:"database"})),...(b||[]).map(e=>({...e,source:"local"}))];return s.jsxs(ce,{children:[s.jsx(ee,{title:"Ordens"}),s.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(re,{iconNode:se,className:"w-8 h-8"}),s.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Ordens"})]}),s.jsx("div",{children:s.jsx(ne,{breadcrumbs:fe})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4",children:[s.jsx("div",{children:s.jsx(N,{variant:"default",asChild:!0,children:s.jsxs(ae,{href:route("app.orders.index",{page:V,oc:z}),children:[s.jsx(te,{"h-4":!0,"w-4":!0}),s.jsx("span",{children:"Voltar"})]})})}),s.jsx("div",{children:!L&&s.jsx(ue,{onSubmit:O,parts:M})})]}),s.jsx("div",{className:"p-4",children:s.jsx("div",{className:"border rounded-lg p-2",children:s.jsxs("form",{onSubmit:T,autoComplete:"off",className:"space-y-8",children:[s.jsxs("div",{className:"grid md:grid-cols-8 gap-4 mt-4",children:[s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(r,{htmlFor:"customer_id",children:"Cliente"}),s.jsx(_,{menuPosition:"fixed",defaultValue:W,options:h,onChange:Y,placeholder:"Selecione o cliente",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,t)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}}),s.jsx(oe,{className:"mt-2",message:o.customer_id})]}),s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(r,{htmlFor:"equipment",children:"Equipamento"}),s.jsx(_,{menuPosition:"fixed",defaultValue:X,options:f,onChange:$,placeholder:"Selecione o status",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,t)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}}),o.equipment_id&&s.jsx("div",{className:"text-red-500 text-sm",children:o.equipment_id})]}),s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(r,{htmlFor:"model",children:"Modelo"}),s.jsx(u,{type:"text",id:"model",value:l.model,onChange:e=>i("model",e.target.value)}),o.model&&s.jsx("div",{className:"text-red-500 text-sm",children:o.model})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"password",children:"Senha"}),s.jsx(u,{type:"text",id:"password",value:l.password,onChange:e=>i("password",e.target.value)}),o.password&&s.jsx("div",{className:"text-red-500 text-sm",children:o.password})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"delivery_forecast",children:"Previsão de entrega"}),s.jsx(ge,{mode:"single",date:l.delivery_forecast,setDate:e=>{if(!e){i("delivery_forecast","");return}const t=e,c=[t.getFullYear(),String(t.getMonth()+1).padStart(2,"0"),String(t.getDate()).padStart(2,"0")].join("-");i("delivery_forecast",c)}})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"defect",children:"Defeito relatado"}),s.jsx(v,{id:"defect",value:l.defect,onChange:e=>i("defect",e.target.value)}),o.defect&&s.jsx("div",{className:"text-red-500 text-sm",children:o.defect})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"state_conservation",children:"Estado de conservação"}),s.jsx(v,{id:"state_conservation",value:l.state_conservation,onChange:e=>i("state_conservation",e.target.value)}),o.state_conservation&&s.jsx("div",{children:o.state_conservation})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"accessories",children:"Acessórios"}),s.jsx(v,{id:"accessories",value:l.accessories,onChange:e=>i("accessories",e.target.value)})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[s.jsx(r,{htmlFor:"budget_description",children:"Descrição do orcamento"}),s.jsx(v,{id:"budget_description",value:l.budget_description,onChange:e=>i("budget_description",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"budget_value",children:"Valor orçamento"}),s.jsx(u,{type:"text",id:"budget_value",value:p(l.budget_value.toString()),onChange:e=>i("budget_value",e.target.value)})]})]}),C.length>0&&(n==null?void 0:n.enableparts)>0&&s.jsxs(me,{className:"p-4 mb-4",children:[s.jsx(pe,{className:"border-b pb-2",children:"Peças adicionadas"}),s.jsx(ve,{className:"flex items-center justify-start gap-4 flex-wrap",children:C.map((e,t)=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(xe,{variant:"secondary",className:"text-sm gap-2",children:[s.jsxs("span",{children:[e.name,"(x",e.quantity,") - ",p(String(Number(e.sale_price)))," = ",p(String(Number(e.sale_price)*Number(e.quantity)))]}),s.jsx(N,{type:"button",variant:"destructive",onClick:c=>e.source==="database"?K(c,e.id):Q(e.id),children:s.jsx(ie,{})})]})},`${e.source}-${e.id}-${t}`))})]}),s.jsxs("div",{className:`grid ${n!=null&&n.enableparts?"md:grid-cols-3":"md:grid-cols-5"} gap-4 mt-4`,children:[!(n!=null&&n.enableparts)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[s.jsx(r,{htmlFor:"parts",children:"Peças adicionadas"}),s.jsx(u,{type:"text",id:"parts",value:l.parts,onChange:e=>i("parts",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"parts_value",children:"Valor das peças"}),s.jsx(u,{type:"text",id:"parts_value",value:p(l.parts_value.toString()),onChange:e=>i("parts_value",e.target.value)})]})]}),(n==null?void 0:n.enableparts)>0&&s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"parts_value",children:"Valor das peças"}),s.jsx(u,{type:"text",id:"parts_value",value:p(l.parts_value),onChange:e=>i("parts_value",e.target.value),required:!0})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"service_value",children:"Valor do serviço"}),s.jsx(u,{type:"text",id:"service_value",value:p(l.service_value),onChange:e=>i("service_value",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"service_cost",children:"Valor total"}),s.jsx(u,{type:"text",id:"service_cost",value:p(l.service_cost),onChange:e=>i("service_cost",e.target.value)})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"service_status",children:"Técnico responsável"}),s.jsx(_,{menuPosition:"fixed",defaultValue:J,options:g,onChange:R,placeholder:"Selecione o técnico",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,t)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}}),o.responsible_technician&&s.jsx("div",{className:"text-red-500 text-sm",children:o.responsible_technician})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"service_status",children:"Status orçamento"}),s.jsx(_,{menuPosition:"fixed",defaultValue:G,options:q,onChange:H,placeholder:"Selecione o status",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,t)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"services_performed",children:"Serviços executados"}),s.jsx(v,{id:"services_performed",value:l.services_performed,onChange:e=>i("services_performed",e.target.value)}),o.services_performed&&s.jsx("div",{className:"text-red-500 text-sm",children:o.services_performed})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"observations",children:"Observações"}),s.jsx(v,{id:"observations",value:l.observations,onChange:e=>i("observations",e.target.value)}),o.observations&&s.jsx("div",{className:"text-red-500 text-sm",children:o.observations})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(N,{type:"submit",disabled:A,children:[s.jsx(le,{}),"Salvar"]})})]})})})]})}export{Ye as default};
