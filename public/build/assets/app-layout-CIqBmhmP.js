import{h as l,j as e,L as I,r as n,b as p}from"./vendor-DSyLU8h0.js";import{f,l as A,b,c as g,S as _,a as L,d as M,e as E,N as h,n as P,h as O,o as F,p as q,q as $,A as D,j as G,k as R}from"./app-sidebar-header-CrXZELhi.js";import{m as z}from"./mask-Dzd4Hpc-.js";import{h as B}from"./moment-BLMuvzoS.js";import{T}from"./index-BBFqCoUG.js";import{u as Y}from"./app-ZNQ0OXrE.js";function H(){const{company:s}=l().props;return e.jsx("footer",{className:"w-full px-3 shadow-md border-sidebar-border/80 border-t flex items-center justify-between",children:e.jsxs("div",{className:"mx-auto p-2 flex items-center justify-between px-4 w-full",children:[e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:["©",B().format("YYYY")," - ",s==null?void 0:s.companyname," - CNPJ: ",z(s==null?void 0:s.cnpj)]}),e.jsx("a",{href:"https://sigmaos.com.br",target:"_blank",className:"text-xs font-semibold text-gray-600",children:"SIGMAOS"})]})})}function X({className:s,...a}){return e.jsx(f,{...a,className:`group-data-[collapsible=icon]:p-0 ${s||""}`,children:e.jsx(A,{children:e.jsx(b,{children:e.jsx(g,{children:void 0})})})})}function Q(){const{company:s}=l().props;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex aspect-square size-8 items-center justify-center bg-white",children:e.jsx("img",{src:`${s!=null&&s.logo?"/storage/logos/"+(s==null?void 0:s.logo):"/images/default.png"}`,alt:"Imagem de logo"})}),e.jsx("div",{className:"ml-1 grid flex-1 text-left text-sm",children:e.jsx("span",{className:"mb-0.5 truncate leading-none font-semibold",children:(s==null?void 0:s.shortname)&&(s==null?void 0:s.shortname)})})]})}function U(){return e.jsxs(_,{collapsible:"icon",variant:"inset",children:[e.jsx(L,{children:e.jsx(b,{children:e.jsx(g,{children:e.jsx(M,{size:"lg",asChild:!0,children:e.jsx(I,{href:"/",prefetch:!0,children:e.jsx(Q,{})})})})})}),e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{items:P}),e.jsx("div",{className:"my-1",children:e.jsx(O,{items:F})}),e.jsx(h,{items:q})]})}),e.jsx($,{children:e.jsx(X,{className:"mt-auto"})})]})}function V(){const{subscription_alert:s}=l().props;if((s==null?void 0:s.status)!=="grace_period")return null;const a=Math.max(0,Math.ceil(3-((s==null?void 0:s.days_overdue)||0)));return e.jsx("div",{className:`${a<=1?"bg-red-600 text-gray-50":"bg-amber-400 text-gray-700"} px-4 py-2 shadow-md mx-4 rounded-md`,children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Sua assinatura venceu. Você tem mais ",e.jsxs("strong",{children:[a," ",a===1?"dia":"dias"]})," de acesso antes do bloqueio."]})]}),e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("open-subscription-modal")),className:"mt-2 sm:mt-0  bg-white text-amber-600 px-4 py-1 rounded-full text-xs font-bold uppercase hover:bg-amber-50 transition-colors shadow-sm",children:"Quero pagar agora"})]})})}function W(){const{subscription_alert:s,plans:a}=l().props,[j,d]=n.useState(!1),[i,v]=n.useState(null),[r,N]=n.useState(null),[c,m]=n.useState(!1),[w,y]=n.useState(!1),S=3;n.useEffect(()=>{(()=>{if((s==null?void 0:s.status)==="grace_period"){const x=localStorage.getItem("subscription_modal_last_shown"),u=new Date().getTime(),k=S*60*60*1e3;(!x||u-parseInt(x)>k)&&(d(!0),localStorage.setItem("subscription_modal_last_shown",u.toString()))}})();const o=()=>d(!0);return window.addEventListener("open-subscription-modal",o),()=>window.removeEventListener("open-subscription-modal",o)},[s]),n.useEffect(()=>{let t=null;return r&&!w&&(y(!0),t=setInterval(async()=>{try{(await p.get(route("subscription.check_status"))).data.status==="active"&&(clearInterval(t),window.location.href=route("app.dashboard"))}catch(o){console.error("Erro ao verificar status",o)}},5e3)),()=>{t&&clearInterval(t)}},[r]);const C=async()=>{if(i){m(!0);try{const t=await p.post(route("subscription.generate_pix"),{plan_id:i});N(t.data)}catch(t){console.error("Erro ao gerar PIX",t)}finally{m(!1)}}};return j?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg relative",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"Assinatura Pendente"}),e.jsxs("p",{className:"mb-4 text-gray-600",children:["Sua assinatura venceu há ",e.jsx("strong",{children:Math.floor((s==null?void 0:s.days_overdue)||0)})," dias. Você tem ",e.jsx("strong",{children:Math.max(0,Math.ceil(3-((s==null?void 0:s.days_overdue)||0)))})," dias de cortesia restantes."]}),r&&e.jsx("div",{className:"mb-4 flex items-center justify-center text-blue-600 animate-pulse bg-blue-50 p-2 rounded",children:e.jsx("span",{className:"text-sm font-medium",children:"Aguardando confirmação do banco..."})}),r?e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:`data:image/png;base64,${r.qr_code}`,alt:"QR Code",className:"mx-auto w-48 h-48 border p-2 mb-4"}),e.jsx("input",{type:"text",readOnly:!0,value:r.qr_code_copy_paste,className:"w-full text-xs border p-2 bg-gray-50"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r.qr_code_copy_paste),alert("Código Copiado!")},className:"text-blue-600 text-sm mt-2 underline block mx-auto",children:"Copiar Código PIX"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Escolha um plano:"}),(!a||a.length===0)&&e.jsx("p",{className:"text-sm text-red-500 bg-red-50 p-2 rounded",children:"Nenhum plano disponível."}),a==null?void 0:a.filter(t=>parseFloat(t.value)>0).map(t=>e.jsxs("div",{className:`border p-3 rounded cursor-pointer transition flex justify-between items-center ${i===t.id?"border-blue-500 bg-blue-50 ring-1 ring-blue-500":"hover:bg-gray-50 border-gray-200"}`,onClick:()=>v(t.id),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-800",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description})]}),e.jsxs("div",{className:"font-semibold text-blue-600",children:["R$ ",parseFloat(t.value).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},t.id)),e.jsx("button",{onClick:C,disabled:!i||c,className:"w-full bg-blue-600 text-white py-3 rounded-lg mt-4 disabled:opacity-50 font-bold",children:c?"Processando...":"Gerar PIX"})]}),e.jsx("button",{onClick:()=>d(!1),className:"mt-6 text-gray-400 text-sm underline w-full text-center",children:"Fechar e pagar depois"})]})}):null}function J({children:s}){return e.jsxs(D,{variant:"sidebar",children:[e.jsx(U,{}),e.jsxs(G,{variant:"sidebar",children:[e.jsx(V,{}),e.jsx(R,{}),e.jsx("div",{className:"grow",children:s}),e.jsx(H,{}),e.jsx(W,{})]})]})}const re=({children:s})=>{const{appearance:a}=Y();return e.jsxs(J,{children:[s,e.jsx(T,{theme:a})]})};export{re as A};
