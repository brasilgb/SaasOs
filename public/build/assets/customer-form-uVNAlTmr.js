import{r as x,u as L,j as e,ba as w,az as P,e as k}from"./vendor-DSyLU8h0.js";import{B as j}from"./button-BbUgFgUv.js";import{I as i}from"./input-D0WU2FnS.js";import{L as r}from"./label-HPS33Bwn.js";import{T}from"./textarea-CnNyks-r.js";import{u as Z,m as A,b as B,a as v}from"./mask-Dzd4Hpc-.js";import{D as I}from"./date-picker-DI91aHwz.js";import{t as f}from"./app-toast-messages-BRPL5wWZ.js";import"./utils-BzNdXqU4.js";import"./moment-BLMuvzoS.js";import"./index-BBFqCoUG.js";function M({zipcode:c,paths:d,setData:o,setError:p,clearErrors:a}){const[s,h]=x.useState(!1);return x.useEffect(()=>{if(!c||c.length!==9)return;(async()=>{try{h(!0),a("zipcode");const l=await(await fetch(`https://viacep.com.br/ws/${c}/json`)).json();if(l.erro){p("zipcode","CEP inválido");return}o(d.state,l.uf),o(d.city,l.localidade),o(d.district,l.bairro),o(d.street,l.logradouro),o(d.complement,l.complemento||"")}catch{p("zipcode","Erro ao buscar CEP")}finally{h(!1)}})()},[c]),{isZipcodeLoading:s}}function K({initialData:c}){const d=!!c,[o,p]=x.useState(null),{data:a,setData:s,post:h,progress:N,processing:g,reset:l,setError:C,clearErrors:y,errors:n,put:b}=L(c||{}),F=()=>{h(route("app.customers.store"),{onSuccess:()=>{f("Cliente salvo","Cadastro realizado com sucesso"),l()}})},S=()=>{b(route("app.customers.update",c.id),{onSuccess:()=>{f("Cliente alterado","Edição realizada com sucesso")}})},z=t=>{t.preventDefault(),d?S():F()};x.useEffect(()=>{s(t=>({...t,cpfcnpj:Z(t.cpfcnpj)}))},[a.cpfcnpj]);const{isZipcodeLoading:u}=M({zipcode:o||"",paths:{zipcode:"zipcode",state:"state",city:"city",district:"district",street:"street",complement:"complement"},setData:(t,m)=>{o!==null&&s(t,m)},setError:C,clearErrors:y});return e.jsxs("form",{onSubmit:z,autoComplete:"off",className:"space-y-8",children:[e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"cpfcnpj",children:"CPF/CNPJ"}),e.jsx(i,{type:"text",id:"cpfcnpj",value:A(a.cpfcnpj),onChange:t=>s("cpfcnpj",t.target.value),maxLength:18}),n.cpfcnpj&&e.jsx("div",{className:"text-red-500 text-sm",children:n.cpfcnpj})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"birth",children:"Nascimento"}),e.jsx(I,{mode:"single",date:a.birth,setDate:t=>{if(!t){s("birth","");return}const m=t,E=[m.getFullYear(),String(m.getMonth()+1).padStart(2,"0"),String(m.getDate()).padStart(2,"0")].join("-");s("birth",E)}})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"Nome"}),e.jsx(i,{type:"text",id:"name",value:a.name,onChange:t=>s("name",t.target.value)}),n.name&&e.jsx("div",{className:"text-red-500 text-sm",children:n.name})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"email",children:"E-mail"}),e.jsx(i,{type:"text",id:"email",value:a.email,onChange:t=>s("email",t.target.value)}),n.email&&e.jsx("div",{className:"text-red-500 text-sm",children:n.email})]})]}),e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"zipcode",children:"CEP"}),e.jsxs("div",{className:"flex gap-2 relative",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(i,{type:"text",id:"zipcode",value:B(a.zipcode),onChange:t=>s("zipcode",t.target.value),maxLength:9,disabled:u}),u&&e.jsx(w,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-muted-foreground"})]}),e.jsx(j,{type:"button",size:"icon",variant:"outline",onClick:()=>p(a.zipcode),children:e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"state",children:"UF"}),e.jsx(i,{type:"text",id:"state",value:a.state,onChange:t=>s("state",t.target.value)}),n.state&&e.jsx("div",{children:n.state})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"city",children:"Cidade"}),e.jsx(i,{type:"text",id:"city",value:a.city,onChange:t=>s("city",t.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"district",children:"Bairro"}),e.jsx(i,{type:"text",id:"district",value:a.district,onChange:t=>s("district",t.target.value)})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"street",children:"Endereço"}),e.jsx(i,{type:"text",id:"street",value:a.street,onChange:t=>s("street",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"complement",children:"Complemento"}),e.jsx(i,{type:"text",id:"complement",value:a.complement,onChange:t=>s("complement",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"number",children:"Número"}),e.jsx(i,{type:"text",id:"number",value:a.number,onChange:t=>s("number",Number(t.target.value))})]})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"phone",children:"Telefone"}),e.jsx(i,{type:"text",id:"phone",value:v(a.phone),onChange:t=>s("phone",t.target.value),maxLength:15}),n.phone&&e.jsx("div",{className:"text-red-500 text-sm",children:n.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"whatsapp",children:"Whatsapp"}),e.jsx(i,{type:"text",id:"whatsapp",value:a.whatsapp,onChange:t=>s("whatsapp",t.target.value),maxLength:13})]}),e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"contactname",children:"Contato"}),e.jsx(i,{type:"text",id:"contactname",value:a.contactname,onChange:t=>s("contactname",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"contactphone",children:"Telefone do contato"}),e.jsx(i,{type:"text",id:"contactphone",value:v(a.contactphone),onChange:t=>s("contactphone",t.target.value),maxLength:15})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"observations",children:"Observações"}),e.jsx(T,{id:"observations",value:a.observations,onChange:t=>s("observations",t.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{type:"submit",disabled:g,children:[e.jsx(k,{}),"Salvar"]})})]})}export{K as default};
