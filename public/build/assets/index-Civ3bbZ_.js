import{u as E,j as e,bH as k,f as V,r as i,bB as H,H as q,a4 as z,bj as L,a5 as M,s as O,l as Y,t as G}from"./vendor-9cxgAHzg.js";import{B as U}from"./breadcrumbs-Bxu_pr7n.js";import{I as J}from"./app-sidebar-header-e0B0cU6n.js";import{A as K}from"./app-layout-B94mYz28.js";import{h as Q}from"./moment-BLMuvzoS.js";import{T as W,a as X,b as p,c,d as Z,e as o,f as $}from"./table-wiBNsqwM.js";import{a as ee,b as ae,c as se,d as te,e as re,f as ne,g as ie,h as oe,i as le,I as ce,A as de}from"./app-pagination-C96396Mq.js";import{B as u}from"./button-DFigV1aq.js";import me from"./app-sale-details-modal-CFUMnf4B.js";import{B as pe}from"./badge-Y4wF56ht.js";import ue from"./receipt-CzKbe58A.js";import{S as he}from"./SaleReceiptPDF-Be7Rz7Fd.js";import"./utils-veIRhKZd.js";import"./mask-Dzd4Hpc-.js";import"./index-C6x6Dy02.js";import"./app-B5Nm2I6l.js";import"./input-D2aH1Wd-.js";import"./dialog-CDKjSUwF.js";function xe({saleId:t}){const{post:l,processing:h}=E(),x=()=>{l(route("app.sales.cancel",t),{preserveScroll:!0})};return e.jsxs(ee,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(u,{variant:"destructive",size:"icon",title:"Cancelar Venda",children:e.jsx(k,{className:"h-4 w-4"})})}),e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(re,{children:"Cancelar venda?"}),e.jsx(ne,{children:"Esta ação irá cancelar a venda e devolver os itens ao estoque. Essa operação não poderá ser desfeita."})]}),e.jsxs(ie,{children:[e.jsx(oe,{children:"Voltar"}),e.jsx(le,{onClick:x,disabled:h,className:"bg-red-600 hover:bg-red-700",children:"Confirmar Cancelamento"})]})]})]})}const je=[{title:"Dashboard",href:route("app.dashboard")},{title:"Vendas",href:"#"}];function Ee({sales:t}){var v,y,C;const{auth:l}=V().props,h=(v=l==null?void 0:l.user)==null?void 0:v.tenant,[x,j]=i.useState(!1),[w,A]=i.useState(null),[s,f]=i.useState(null),b=i.useRef(null),[g,D]=i.useState(!1),[F,N]=i.useState(!1),R=H.useReactToPrint({contentRef:b,onAfterPrint:()=>f(null)});i.useEffect(()=>{s&&R()},[s]);const P=a=>{A(a),j(!0)},B=a=>{N(!0);const n={...a,items:a.items.map(r=>{var d;return{name:((d=r.part)==null?void 0:d.name)||r.name||"Produto",selected_quantity:r.quantity,sale_price:r.unit_price}})};f(n),N(!1)},_=async a=>{var n;if(a){D(!0);try{const r=((n=a.customer)==null?void 0:n.name)||"Consumidor Final",d=a.items.map(m=>{var S;return{name:((S=m.part)==null?void 0:S.name)||m.name||"Produto",selected_quantity:m.quantity,sale_price:m.unit_price}}),I=await G(e.jsx(he,{items:d,total:a.total_amount,customerName:r,sale:a,company:h})).toBlob(),T=URL.createObjectURL(I);window.open(T,"_blank")}catch(r){console.error("Erro ao gerar PDF:",r),alert("Erro ao gerar o PDF.")}finally{D(!1)}}};return e.jsxs(K,{children:[e.jsx(me,{isOpen:x,onClose:()=>j(!1),sale:w}),e.jsx("div",{style:{display:"none"},children:e.jsx(ue,{ref:b,paper:"80mm",items:(s==null?void 0:s.items)||[],total:new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format((s==null?void 0:s.total_amount)||0),customer:((y=s==null?void 0:s.customer)==null?void 0:y.name)||"Consumidor",sale:s})}),e.jsx(q,{title:"Vendas"}),e.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{iconNode:z,className:"w-8 h-8"}),e.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Vendas"})]}),e.jsx("div",{children:e.jsx(U,{breadcrumbs:je})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(ce,{placeholder:"Buscar vendas por número e cliente",url:"app.sales.index"})}),e.jsx("div",{className:"w-full flex justify-end"})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"border rounded-lg",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(p,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Cliente"}),e.jsx(c,{children:"Total"}),e.jsx(c,{children:"Data venda"}),e.jsx(c,{})]})}),e.jsx(Z,{children:(t==null?void 0:t.data.length)>0?(C=t==null?void 0:t.data)==null?void 0:C.map(a=>{var n;return e.jsxs(p,{children:[e.jsx(o,{children:a.sales_number}),e.jsx(o,{children:((n=a.customer)==null?void 0:n.name)||"Cliente não informado"}),e.jsx(o,{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.total_amount)}),e.jsx(o,{children:Q(a.created_at).format("DD/MM/YYYY")}),e.jsxs(o,{className:"flex justify-end gap-2",children:[a.status==="completed"&&e.jsx(xe,{saleId:a.id}),a.status==="cancelled"&&e.jsx(pe,{variant:"destructive",children:"Cancelada"}),e.jsxs(u,{type:"button",onClick:()=>_(a),disabled:F||g,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[g?e.jsx(L,{className:"size-4 animate-spin"}):e.jsx(M,{className:"size-4"}),"Recibo PDF"]}),e.jsx(u,{onClick:()=>B(a),size:"icon",className:"bg-blue-600 hover:bg-blue-500 text-white",title:"Imprimir Recibo",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(u,{onClick:()=>P(a),size:"icon",className:"bg-orange-500 hover:bg-orange-600 text-white",title:"Ver Detalhes",children:e.jsx(Y,{className:"h-4 w-4"})})]})]},a.id)}):e.jsx(p,{children:e.jsx(o,{colSpan:5,className:"h-16 w-full flex items-center justify-center",children:"Não há dados a serem mostrados no momento."})})}),e.jsx($,{children:e.jsx(p,{children:e.jsx(o,{colSpan:5,children:e.jsx(de,{data:t})})})})]})})})]})}export{Ee as default};
