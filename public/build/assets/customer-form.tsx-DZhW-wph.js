import{r as x,u as w,j as e,bj as L,aA as P,b as k}from"./vendor-9cxgAHzg.js";import{B as j}from"./button-DFigV1aq.js";import{I as i}from"./input-D2aH1Wd-.js";import{L as r}from"./label-BRTi3l1J.js";import{T}from"./textarea-a2nrSQrB.js";import{u as A,m as Z,b as B,a as v}from"./mask-Dzd4Hpc-.js";import{D as I}from"./date-picker-B7Kdmu-S.js";import{t as f}from"./app-toast-messages-BBGi5OF3.js";import"./utils-veIRhKZd.js";import"./moment-BLMuvzoS.js";import"./index-C6x6Dy02.js";function M({zipcode:n,paths:d,setData:c,setError:p,clearErrors:a}){const[s,h]=x.useState(!1);return x.useEffect(()=>{if(!n||n.length!==9)return;(async()=>{try{h(!0),a("zipcode");const l=await(await fetch(`https://viacep.com.br/ws/${n}/json`)).json();if(l.erro){p("zipcode","CEP inválido");return}c(d.state,l.uf),c(d.city,l.localidade),c(d.district,l.bairro),c(d.street,l.logradouro),c(d.complement,l.complemento||"")}catch{p("zipcode","Erro ao buscar CEP")}finally{h(!1)}})()},[n]),{isZipcodeLoading:s}}function K({initialData:n}){const d=!!n,[c,p]=x.useState(null),{data:a,setData:s,post:h,progress:N,processing:g,reset:l,setError:C,clearErrors:y,errors:o,put:b}=w(n||{}),F=()=>{h(route("app.customers.store"),{onSuccess:()=>{f("Cliente salvo","Cadastro realizado com sucesso"),l()}})},S=()=>{b(route("app.customers.update",n.id),{onSuccess:()=>{f("Cliente alterado","Edição realizada com sucesso")}})},E=t=>{t.preventDefault(),d?S():F()};x.useEffect(()=>{s(t=>({...t,cpf:A(t.cpf)}))},[a.cpf]);const{isZipcodeLoading:u}=M({zipcode:c||"",paths:{zipcode:"zipcode",state:"state",city:"city",district:"district",street:"street",complement:"complement"},setData:(t,m)=>{c!==null&&s(t,m)},setError:C,clearErrors:y});return e.jsxs("form",{onSubmit:E,autoComplete:"off",className:"space-y-8",children:[e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"CPF/CNPJ"}),e.jsx(i,{type:"text",id:"cpf",value:Z(a.cpf),onChange:t=>s("cpf",t.target.value),maxLength:18}),o.cpf&&e.jsx("div",{className:"text-red-500 text-sm",children:o.cpf})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"birth",children:"Nascimento"}),e.jsx(I,{mode:"single",date:a.birth,setDate:t=>{if(!t){s("birth","");return}const m=t,z=[m.getFullYear(),String(m.getMonth()+1).padStart(2,"0"),String(m.getDate()).padStart(2,"0")].join("-");s("birth",z)}})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"Nome"}),e.jsx(i,{type:"text",id:"name",value:a.name,onChange:t=>s("name",t.target.value)}),o.name&&e.jsx("div",{className:"text-red-500 text-sm",children:o.name})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"email",children:"E-mail"}),e.jsx(i,{type:"text",id:"email",value:a.email,onChange:t=>s("email",t.target.value)}),o.email&&e.jsx("div",{className:"text-red-500 text-sm",children:o.email})]})]}),e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"zipcode",children:"CEP"}),e.jsxs("div",{className:"flex gap-2 relative",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(i,{type:"text",id:"zipcode",value:B(a.zipcode),onChange:t=>s("zipcode",t.target.value),maxLength:9,disabled:u}),u&&e.jsx(L,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-muted-foreground"})]}),e.jsx(j,{type:"button",size:"icon",variant:"outline",onClick:()=>p(a.zipcode),children:e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"state",children:"UF"}),e.jsx(i,{type:"text",id:"state",value:a.state,onChange:t=>s("state",t.target.value)}),o.state&&e.jsx("div",{children:o.state})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"city",children:"Cidade"}),e.jsx(i,{type:"text",id:"city",value:a.city,onChange:t=>s("city",t.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"district",children:"Bairro"}),e.jsx(i,{type:"text",id:"district",value:a.district,onChange:t=>s("district",t.target.value)})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"street",children:"Endereço"}),e.jsx(i,{type:"text",id:"street",value:a.street,onChange:t=>s("street",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"complement",children:"Complemento"}),e.jsx(i,{type:"text",id:"complement",value:a.complement,onChange:t=>s("complement",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"number",children:"Número"}),e.jsx(i,{type:"text",id:"number",value:a.number,onChange:t=>s("number",Number(t.target.value))})]})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"phone",children:"Telefone"}),e.jsx(i,{type:"text",id:"phone",value:v(a.phone),onChange:t=>s("phone",t.target.value),maxLength:15}),o.phone&&e.jsx("div",{className:"text-red-500 text-sm",children:o.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"whatsapp",children:"Whatsapp"}),e.jsx(i,{type:"text",id:"whatsapp",value:a.whatsapp,onChange:t=>s("whatsapp",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"contactname",children:"Contato"}),e.jsx(i,{type:"text",id:"contactname",value:a.contactname,onChange:t=>s("contactname",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"contactphone",children:"Telefone do contato"}),e.jsx(i,{type:"text",id:"contactphone",value:v(a.contactphone),onChange:t=>s("contactphone",t.target.value),maxLength:15})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"observations",children:"Observações"}),e.jsx(T,{id:"observations",value:a.observations,onChange:t=>s("observations",t.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{type:"submit",disabled:g,children:[e.jsx(k,{}),"Salvar"]})})]})}export{K as default};
