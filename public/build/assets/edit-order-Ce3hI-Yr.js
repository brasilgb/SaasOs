import{a as ae,r as w,u as te,j as s,H as ie,L as le}from"./app-MW4Pb1eJ.js";import{B as ne}from"./breadcrumbs-B6jmOd94.js";import{I as re}from"./app-sidebar-header-cjDf8g-v.js";import{B as _}from"./button-LiVZZ4Rl.js";import{A as ce}from"./app-layout-CnePAsV2.js";import{I as d}from"./input-hyU40JyS.js";import{L as n}from"./label-DGjF4af6.js";import{T as p}from"./textarea-CXiGn6-I.js";import{b as F}from"./dataSelect-DvV_o7aD.js";import{S as b}from"./react-select.esm-BFmMNa8_.js";import{I as oe}from"./input-error-D9xnNClk.js";import{A as de}from"./app-alert-success-B3nhjva3.js";import{d as N,e as m}from"./mask-B61Tbbsk.js";import{h as me}from"./moment-BLMuvzoS.js";import ue from"./add-parts-TeIYVa8j.js";import{C as q,c as P,f as k}from"./card-G7BLFYm0.js";import{B}from"./badge-BPZUw8Ms.js";import{W as pe}from"./wrench-DhCr2WBU.js";import{A as ve}from"./arrow-left-C5N4cvlT.js";import{X as D}from"./x-B5cphctK.js";import{S as xe}from"./save-GNgz5pGa.js";import"./utils-CDN07tui.js";import"./chevron-right-Ddi3_tul.js";import"./createLucideIcon-CTQhmRsV.js";import"./shopping-cart-CqgIUXK4.js";import"./memory-stick-wZFSkTLA.js";import"./file-text-CTMeLqvV.js";import"./printer-D5KgVt90.js";import"./index-BC0UYgl-.js";import"./index-B_7Rk9Iu.js";import"./index-ZyviP9Bf.js";import"./tslib.es6-M_FJ09fS.js";import"./index-AVQsBDDI.js";import"./floating-ui.dom-CT80KWrA.js";import"./index-C4PkXqrt.js";import"./index-DXa_AW1t.js";import"./chevron-down-DoqU6Z8H.js";import"./menu-D9wzpg1l.js";import"./book-open-BSjZcib3.js";import"./dialog-CGShdc46.js";import"./trash-2-CZs-RTvA.js";const he=[{title:"Dashboard",href:route("app.dashboard")},{title:"Ordens",href:route("app.orders.index")},{title:"Editar",href:"#"}];function ns({customers:I,order:a,technicals:L,equipments:V,parts:z,orderparts:v}){var S;console.log(v);const{flash:y,ziggy:A,othersetting:c}=ae().props,E=c!=null&&c.enableparts?"":"parts",{page:M,oc:O}=A.query,[x,h]=w.useState([]),g=I.map(e=>({value:e.id,label:e.name})),j=L.map(e=>({value:e.id,label:e.name})),f=V.map(e=>({value:e.id,label:e.equipment})),{data:l,post:T,setData:t,patch:H,progress:ge,processing:R,reset:je,errors:r}=te({customer_id:a==null?void 0:a.customer_id,equipment_id:a==null?void 0:a.equipment_id,model:a==null?void 0:a.model,password:a==null?void 0:a.password,defect:a==null?void 0:a.defect,state_conservation:a==null?void 0:a.state_conservation,accessories:a==null?void 0:a.accessories,budget_description:a==null?void 0:a.budget_description,budget_value:a==null?void 0:a.budget_value,services_performed:a.services_performed,parts:a.parts,parts_value:a.parts_value,service_value:a.service_value,service_cost:a.service_cost,delivery_date:a.delivery_date,responsible_technician:a.responsible_technician,service_status:a==null?void 0:a.service_status,delivery_forecast:a==null?void 0:a.delivery_forecast,observations:a==null?void 0:a.observations,allparts:""}),Y=e=>{h(e);const i=e.reduce((o,u)=>o+Number(u.sale_price*u.quantity),0);t("parts_value",String(i)),t("allparts",e)},W=async e=>{e.preventDefault(),H(route("app.orders.update",a.id)),h([])};w.useEffect(()=>{t(i=>({...i,budget_value:N(i==null?void 0:i.budget_value)})),t(i=>({...i,parts_value:N(i==null?void 0:i.parts_value)})),t(i=>({...i,service_value:N(i==null?void 0:i.service_value)}));const e=parseFloat(l==null?void 0:l.parts_value)+parseFloat(l==null?void 0:l.service_value);t(i=>({...i,service_cost:e.toFixed(2)})),l.service_status==8&&t(i=>({...i,delivery_date:me().format("YYYY-MM-DD HH:mm:ss")}))},[l.parts_value,l.service_value,l.budget_value,l.delivery_date,l.service_status]);const $=e=>{t("customer_id",(e==null?void 0:e.value)||"")},X=e=>{t("equipment_id",e==null?void 0:e.value)},G=e=>{t("service_status",e==null?void 0:e.value)},J=e=>{t("responsible_technician",e==null?void 0:e.value)},K=g==null?void 0:g.filter(e=>e.value==(a==null?void 0:a.customer_id)).map(e=>({value:e.value,label:e.label})),Q=f==null?void 0:f.filter(e=>e.value==(a==null?void 0:a.equipment_id)).map(e=>({value:e.value,label:e.label})),U=(S=F)==null?void 0:S.filter(e=>e.value==(a==null?void 0:a.service_status)).map(e=>({value:e.value,label:e.label})),Z=j==null?void 0:j.filter(e=>e.value==(a==null?void 0:a.responsible_technician)).map(e=>({value:e.value,label:e.label})),ee=(e,i)=>{e.preventDefault(),T(route("app.orders.removePart",{order_id:a.id,part_id:i})),t(o=>({...o,parts_value:"0.00"})),t(o=>({...o,service_value:"0.00"})),t(o=>({...o,service_cost:"0.00"})),t(o=>({...o,allparts:[]})),h([])},se=e=>{const i=x.filter(u=>u.id!==e);h(i);const o=i.reduce((u,C)=>u+Number(C.sale_price*C.quantity),0);t(u=>({...u,parts_value:o.toFixed(2)})),h([])};return s.jsxs(ce,{children:[y.message&&s.jsx(de,{message:y.message}),s.jsx(ie,{title:"Ordens"}),s.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(re,{iconNode:pe,className:"w-8 h-8"}),s.jsx("h2",{className:"text-xl font-semibold tracking-tight",children:"Ordens"})]}),s.jsx("div",{children:s.jsx(ne,{breadcrumbs:he})})]}),s.jsxs("div",{className:"flex items-center justify-between p-4",children:[s.jsx("div",{children:s.jsx(_,{variant:"default",asChild:!0,children:s.jsxs(le,{href:route("app.orders.index",{page:M,oc:O}),children:[s.jsx(ve,{"h-4":!0,"w-4":!0}),s.jsx("span",{children:"Voltar"})]})})}),s.jsx("div",{children:!E&&s.jsx(ue,{onSubmit:Y,parts:z})})]}),s.jsx("div",{className:"p-4",children:s.jsx("div",{className:"border rounded-lg p-2",children:s.jsxs("form",{onSubmit:W,className:"space-y-8",children:[s.jsxs("div",{className:"grid md:grid-cols-8 gap-4 mt-4",children:[s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(n,{htmlFor:"customer_id",children:"Cliente"}),s.jsx(b,{menuPosition:"fixed",defaultValue:K,options:g,onChange:$,placeholder:"Selecione o cliente",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,i)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}}),s.jsx(oe,{className:"mt-2",message:r.customer_id})]}),s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(n,{htmlFor:"equipment",children:"Equipamento"}),s.jsx(b,{menuPosition:"fixed",defaultValue:Q,options:f,onChange:X,placeholder:"Selecione o status",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,i)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}}),r.equipment_id&&s.jsx("div",{className:"text-red-500 text-sm",children:r.equipment_id})]}),s.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[s.jsx(n,{htmlFor:"model",children:"Modelo"}),s.jsx(d,{type:"text",id:"model",value:l.model,onChange:e=>t("model",e.target.value)}),r.model&&s.jsx("div",{className:"text-red-500 text-sm",children:r.model})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"password",children:"Senha"}),s.jsx(d,{type:"text",id:"password",value:l.password,onChange:e=>t("password",e.target.value)}),r.password&&s.jsx("div",{className:"text-red-500 text-sm",children:r.password})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"delivery_forecast",children:"Previsão de entrega"}),s.jsx(d,{type:"date",id:"delivery_forecast",value:l.delivery_forecast,onChange:e=>t("delivery_forecast",e.target.value)}),r.delivery_forecast&&s.jsx("div",{className:"text-red-500 text-sm",children:r.delivery_forecast})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"defect",children:"Defeito relatado"}),s.jsx(p,{id:"defect",value:l.defect,onChange:e=>t("defect",e.target.value)}),r.defect&&s.jsx("div",{className:"text-red-500 text-sm",children:r.defect})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"state_conservation",children:"Estado de conservação"}),s.jsx(p,{id:"state_conservation",value:l.state_conservation,onChange:e=>t("state_conservation",e.target.value)}),r.state_conservation&&s.jsx("div",{children:r.state_conservation})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"accessories",children:"Acessórios"}),s.jsx(p,{id:"accessories",value:l.accessories,onChange:e=>t("accessories",e.target.value)})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[s.jsx(n,{htmlFor:"budget_description",children:"Descrição do orcamento"}),s.jsx(p,{id:"budget_description",value:l.budget_description,onChange:e=>t("budget_description",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"budget_value",children:"Valor orçamento"}),s.jsx(d,{type:"text",id:"budget_value",value:m(l.budget_value.toString()),onChange:e=>t("budget_value",e.target.value)})]})]}),(v==null?void 0:v.length)>0&&(c==null?void 0:c.enableparts)>0&&s.jsxs(q,{className:"p-4 mb-4",children:[s.jsx(P,{className:"border-b pb-2",children:"Peças adicionadas A"}),s.jsx(k,{className:"flex items-center justify-start gap-4",children:v.map(e=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(B,{variant:"secondary",className:"text-sm gap-2",children:[s.jsxs("span",{children:[e.name,"(x",e.pivot.quantity,") - ",m(String(Number(e.sale_price)))," = ",m(String(Number(e.sale_price)*Number(e.pivot.quantity)))]}),s.jsx(_,{type:"button",variant:"destructive",onClick:i=>ee(i,e.id),children:s.jsx(D,{})})]})},e.id))})]}),(x==null?void 0:x.length)>0&&s.jsxs(q,{className:"p-4 mb-4",children:[s.jsx(P,{className:"border-b pb-2",children:"Peças adicionadas B"}),s.jsx(k,{className:"flex items-center justify-start gap-4",children:x.map(e=>s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(B,{variant:"secondary",className:"text-sm gap-2",children:[s.jsxs("span",{children:[e.name,"(x",e.quantity,") - ",m(String(Number(e.sale_price)))," = ",m(String(Number(e.sale_price)*Number(e.quantity)))]}),s.jsx(_,{type:"button",variant:"destructive",onClick:()=>se(e.id),children:s.jsx(D,{})})]})},e.id))})]}),s.jsxs("div",{className:`grid ${c!=null&&c.enableparts?"md:grid-cols-3":"md:grid-cols-5"} gap-4 mt-4`,children:[!(c!=null&&c.enableparts)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[s.jsx(n,{htmlFor:"parts",children:"Peças adicionadas"}),s.jsx(d,{type:"text",id:"parts",value:l.parts,onChange:e=>t("parts",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"parts_value",children:"Valor das peças"}),s.jsx(d,{type:"text",id:"parts_value",value:m(l.parts_value.toString()),onChange:e=>t("parts_value",e.target.value)})]})]}),(c==null?void 0:c.enableparts)>0&&s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"parts_value",children:"Valor das peças"}),s.jsx(d,{type:"text",id:"parts_value",value:m(l.parts_value),onChange:e=>t("parts_value",e.target.value),required:!0})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"service_value",children:"Valor do serviço"}),s.jsx(d,{type:"text",id:"service_value",value:m(l.service_value),onChange:e=>t("service_value",e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"service_cost",children:"Valor total"}),s.jsx(d,{type:"text",id:"service_cost",value:m(l.service_cost),onChange:e=>t("service_cost",e.target.value)})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"service_status",children:"Técnico responsável"}),s.jsx(b,{menuPosition:"fixed",defaultValue:Z,options:j,onChange:J,placeholder:"Selecione o técnico",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,i)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"service_status",children:"Status orçamento"}),s.jsx(b,{menuPosition:"fixed",defaultValue:U,options:F,onChange:G,placeholder:"Selecione o status",className:"shadow-xs p-0 border text-gray-700 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-9",styles:{control:(e,i)=>({...e,fontSize:"14px",boxShadow:"none",border:"none",background:"transparent",paddingBottom:"2px"}),dropdownIndicator:e=>({...e}),menuList:e=>({...e,fontSize:"14px"})}})]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"services_performed",children:"Serviços executados"}),s.jsx(p,{id:"services_performed",value:l.services_performed,onChange:e=>t("services_performed",e.target.value)}),r.services_performed&&s.jsx("div",{className:"text-red-500 text-sm",children:r.services_performed})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(n,{htmlFor:"observations",children:"Observações"}),s.jsx(p,{id:"observations",value:l.observations,onChange:e=>t("observations",e.target.value)}),r.observations&&s.jsx("div",{className:"text-red-500 text-sm",children:r.observations})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(_,{type:"submit",disabled:R,children:[s.jsx(xe,{}),"Salvar"]})})]})})})]})}export{ns as default};
