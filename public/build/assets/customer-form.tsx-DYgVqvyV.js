import{r as h,u as E,j as e,bj as S,b as z}from"./vendor-9cxgAHzg.js";import{B as L}from"./button-DFigV1aq.js";import{I as i}from"./input-D2aH1Wd-.js";import{L as r}from"./label-BRTi3l1J.js";import{T as w}from"./textarea-a2nrSQrB.js";import{u as P,m as k,b as T,a as v}from"./mask-Dzd4Hpc-.js";import{D as A}from"./date-picker-B7Kdmu-S.js";import{t as f}from"./app-toast-messages-BBGi5OF3.js";import"./utils-veIRhKZd.js";import"./moment-BLMuvzoS.js";import"./index-C6x6Dy02.js";function B({zipcode:n,paths:d,setData:s,setError:a,clearErrors:m}){const[x,l]=h.useState(!1);return h.useEffect(()=>{if(!n||n.length!==9)return;(async()=>{try{l(!0),m("zipcode");const c=await(await fetch(`https://viacep.com.br/ws/${n}/json`)).json();if(c.erro){a("zipcode","CEP inválido");return}s(d.state,c.uf),s(d.city,c.localidade),s(d.district,c.bairro),s(d.street,c.logradouro),s(d.complement,c.complemento||"")}catch{a("zipcode","Erro ao buscar CEP")}finally{l(!1)}})()},[n]),{isZipcodeLoading:x}}function D({initialData:n}){const d=!!n,{data:s,setData:a,post:m,progress:x,processing:l,reset:g,setError:u,clearErrors:c,errors:o,put:C}=E(n||{}),N=()=>{m(route("app.customers.store"),{onSuccess:()=>{f("Cliente salvo","Cadastro realizado com sucesso"),g()}})},y=()=>{C(route("app.customers.update",n.id),{onSuccess:()=>{f("Cliente alterado","Edição realizada com sucesso")}})},b=t=>{t.preventDefault(),d?y():N()};h.useEffect(()=>{a(t=>({...t,cpf:P(t.cpf)}))},[s.cpf]);const{isZipcodeLoading:j}=B({zipcode:s.zipcode,paths:{zipcode:"zipcode",state:"state",city:"city",district:"district",street:"street",complement:"complement"},setData:a,setError:u,clearErrors:c});return e.jsxs("form",{onSubmit:b,autoComplete:"off",className:"space-y-8",children:[e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"CPF/CNPJ"}),e.jsx(i,{type:"text",id:"cpf",value:k(s.cpf),onChange:t=>a("cpf",t.target.value),maxLength:18}),o.cpf&&e.jsx("div",{className:"text-red-500 text-sm",children:o.cpf})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"birth",children:"Nascimento"}),e.jsx(A,{mode:"single",date:s.birth,setDate:t=>{if(!t){a("birth","");return}const p=t,F=[p.getFullYear(),String(p.getMonth()+1).padStart(2,"0"),String(p.getDate()).padStart(2,"0")].join("-");a("birth",F)}})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"name",children:"Nome"}),e.jsx(i,{type:"text",id:"name",value:s.name,onChange:t=>a("name",t.target.value)}),o.name&&e.jsx("div",{className:"text-red-500 text-sm",children:o.name})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"email",children:"E-mail"}),e.jsx(i,{type:"text",id:"email",value:s.email,onChange:t=>a("email",t.target.value)}),o.email&&e.jsx("div",{className:"text-red-500 text-sm",children:o.email})]})]}),e.jsxs("div",{className:"grid md:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2 relative",children:[e.jsx(r,{htmlFor:"zipcode",children:"CEP"}),e.jsx(i,{type:"text",id:"zipcode",value:T(s.zipcode),onChange:t=>a("zipcode",t.target.value),maxLength:9,disabled:j}),j&&e.jsx(S,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-muted-foreground"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"state",children:"UF"}),e.jsx(i,{type:"text",id:"state",value:s.state,onChange:t=>a("state",t.target.value)}),o.state&&e.jsx("div",{children:o.state})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"city",children:"Cidade"}),e.jsx(i,{type:"text",id:"city",value:s.city,onChange:t=>a("city",t.target.value)})]}),e.jsxs("div",{className:"md:col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"district",children:"Bairro"}),e.jsx(i,{type:"text",id:"district",value:s.district,onChange:t=>a("district",t.target.value)})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"street",children:"Endereço"}),e.jsx(i,{type:"text",id:"street",value:s.street,onChange:t=>a("street",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"complement",children:"Complemento"}),e.jsx(i,{type:"text",id:"complement",value:s.complement,onChange:t=>a("complement",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"number",children:"Número"}),e.jsx(i,{type:"text",id:"number",value:s.number,onChange:t=>a("number",Number(t.target.value))})]})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4 mt-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"phone",children:"Telefone"}),e.jsx(i,{type:"text",id:"phone",value:v(s.phone),onChange:t=>a("phone",t.target.value),maxLength:15}),o.phone&&e.jsx("div",{className:"text-red-500 text-sm",children:o.phone})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"whatsapp",children:"Whatsapp"}),e.jsx(i,{type:"text",id:"whatsapp",value:s.whatsapp,onChange:t=>a("whatsapp",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"contactname",children:"Contato"}),e.jsx(i,{type:"text",id:"contactname",value:s.contactname,onChange:t=>a("contactname",t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"contactphone",children:"Telefone do contato"}),e.jsx(i,{type:"text",id:"contactphone",value:v(s.contactphone),onChange:t=>a("contactphone",t.target.value),maxLength:15})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"observations",children:"Observações"}),e.jsx(w,{id:"observations",value:s.observations,onChange:t=>a("observations",t.target.value)})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(L,{type:"submit",disabled:l,children:[e.jsx(z,{}),"Salvar"]})})]})}export{D as default};
